From 1007433e0251caa671837274a098c3d12037ccd9 Mon Sep 17 00:00:00 2001
From: S-trace <S-trace@list.ru>
Date: Wed, 11 May 2016 02:39:42 +0300
Subject: [PATCH] [SMALI] services.jar: Patch for multiboot

---
 .../android/server/MountService$StorageItem.smali  | 224 ++++++
 .../android/server/MountService$XmlContainer.smali | 340 ++++++++
 .../smali/com/android/server/MountService.smali    | 885 +++++++++++++++------
 3 files changed, 1203 insertions(+), 246 deletions(-)
 create mode 100644 services.jar/smali/com/android/server/MountService$StorageItem.smali
 create mode 100644 services.jar/smali/com/android/server/MountService$XmlContainer.smali

diff --git a/services.jar/smali/com/android/server/MountService$StorageItem.smali b/services.jar/smali/com/android/server/MountService$StorageItem.smali
new file mode 100644
index 0000000..a09c483
--- /dev/null
+++ b/services.jar/smali/com/android/server/MountService$StorageItem.smali
@@ -0,0 +1,224 @@
+.class public Lcom/android/server/MountService$StorageItem;
+.super Lcom/android/server/MountService$XmlContainer;
+.source "MountService.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Lcom/android/server/MountService;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x1
+    name = "StorageItem"
+.end annotation
+
+
+# instance fields
+.field public allowMassStorage:Z
+
+.field public description:Ljava/lang/String;
+
+.field public descriptionId:I
+
+.field public emulated:Z
+
+.field public maxFileSize:J
+
+.field public mtpReserve:I
+
+.field public path:Ljava/lang/String;
+
+.field public primary:Z
+
+.field public removable:Z
+
+.field final synthetic this$0:Lcom/android/server/MountService;
+
+
+# direct methods
+.method private constructor <init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;)V
+    .locals 3
+    .param p2, "context"    # Landroid/content/Context;
+    .param p3, "parser"    # Lorg/xmlpull/v1/XmlPullParser;
+
+    .prologue
+    const/4 v2, 0x0
+
+    const/4 v1, 0x0
+
+
+    iput-object p1, p0, Lcom/android/server/MountService$StorageItem;->this$0:Lcom/android/server/MountService;
+
+
+    invoke-direct {p0, p1, p2, p3, v2}, Lcom/android/server/MountService$XmlContainer;-><init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;Lcom/android/server/MountService$1;)V
+
+
+    iput-object v2, p0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
+
+
+    const/4 v0, -0x1
+
+    iput v0, p0, Lcom/android/server/MountService$StorageItem;->descriptionId:I
+
+
+    iput-object v2, p0, Lcom/android/server/MountService$StorageItem;->description:Ljava/lang/String;
+
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->primary:Z
+
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->removable:Z
+
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->emulated:Z
+
+
+    iput v1, p0, Lcom/android/server/MountService$StorageItem;->mtpReserve:I
+
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->allowMassStorage:Z
+
+
+    const-wide/16 v0, 0x0
+
+    iput-wide v0, p0, Lcom/android/server/MountService$StorageItem;->maxFileSize:J
+
+
+    return-void
+.end method
+
+.method synthetic constructor <init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;Lcom/android/server/MountService$1;)V
+    .locals 0
+    .param p1, "x0"    # Lcom/android/server/MountService;
+    .param p2, "x1"    # Landroid/content/Context;
+    .param p3, "x2"    # Lorg/xmlpull/v1/XmlPullParser;
+    .param p4, "x3"    # Lcom/android/server/MountService$1;
+
+    .prologue
+
+    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/MountService$StorageItem;-><init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;)V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public loadNode()Z
+    .locals 6
+
+    .prologue
+    const-wide/16 v4, 0x400
+
+    const/4 v2, 0x0
+
+    const/4 v3, -0x1
+
+    const/4 v0, 0x0
+
+
+    const-string v1, "mountPoint"
+
+    invoke-virtual {p0, v1, v2}, Lcom/android/server/MountService$StorageItem;->getString(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v1
+
+    iput-object v1, p0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
+
+
+    const-string v1, "storageDescription"
+
+    invoke-virtual {p0, v1, v3}, Lcom/android/server/MountService$StorageItem;->getResourceId(Ljava/lang/String;I)I
+
+    move-result v1
+
+    iput v1, p0, Lcom/android/server/MountService$StorageItem;->descriptionId:I
+
+
+    const-string v1, "storageDescription"
+
+    invoke-virtual {p0, v1, v2}, Lcom/android/server/MountService$StorageItem;->getText(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v1
+
+    iput-object v1, p0, Lcom/android/server/MountService$StorageItem;->description:Ljava/lang/String;
+
+
+    const-string v1, "primary"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getBoolean(Ljava/lang/String;Z)Z
+
+    move-result v1
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->primary:Z
+
+
+    const-string v1, "removable"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getBoolean(Ljava/lang/String;Z)Z
+
+    move-result v1
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->removable:Z
+
+
+    const-string v1, "emulated"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getBoolean(Ljava/lang/String;Z)Z
+
+    move-result v1
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->emulated:Z
+
+
+    const-string v1, "mtpReserve"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getInt(Ljava/lang/String;I)I
+
+    move-result v1
+
+    iput v1, p0, Lcom/android/server/MountService$StorageItem;->mtpReserve:I
+
+
+    const-string v1, "allowMassStorage"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getBoolean(Ljava/lang/String;Z)Z
+
+    move-result v1
+
+    iput-boolean v1, p0, Lcom/android/server/MountService$StorageItem;->allowMassStorage:Z
+
+
+    const-string v1, "maxFileSize"
+
+    invoke-virtual {p0, v1, v0}, Lcom/android/server/MountService$StorageItem;->getInt(Ljava/lang/String;I)I
+
+    move-result v1
+
+    int-to-long v1, v1
+
+    mul-long/2addr v1, v4
+
+    mul-long/2addr v1, v4
+
+    iput-wide v1, p0, Lcom/android/server/MountService$StorageItem;->maxFileSize:J
+
+
+    iget-object v1, p0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
+
+    if-eqz v1, :cond_0
+
+    iget v1, p0, Lcom/android/server/MountService$StorageItem;->descriptionId:I
+
+    if-ne v1, v3, :cond_1
+
+
+    :cond_0
+    :goto_0
+    return v0
+
+    :cond_1
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
diff --git a/services.jar/smali/com/android/server/MountService$XmlContainer.smali b/services.jar/smali/com/android/server/MountService$XmlContainer.smali
new file mode 100644
index 0000000..54d9699
--- /dev/null
+++ b/services.jar/smali/com/android/server/MountService$XmlContainer.smali
@@ -0,0 +1,340 @@
+.class public Lcom/android/server/MountService$XmlContainer;
+.super Ljava/lang/Object;
+.source "MountService.java"
+
+
+# annotations
+.annotation system Ldalvik/annotation/EnclosingClass;
+    value = Lcom/android/server/MountService;
+.end annotation
+
+.annotation system Ldalvik/annotation/InnerClass;
+    accessFlags = 0x1
+    name = "XmlContainer"
+.end annotation
+
+
+# instance fields
+.field public mContext:Landroid/content/Context;
+
+.field public mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+.field final synthetic this$0:Lcom/android/server/MountService;
+
+
+# direct methods
+.method private constructor <init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;)V
+    .locals 0
+    .param p2, "context"    # Landroid/content/Context;
+    .param p3, "parser"    # Lorg/xmlpull/v1/XmlPullParser;
+
+    .prologue
+
+    iput-object p1, p0, Lcom/android/server/MountService$XmlContainer;->this$0:Lcom/android/server/MountService;
+
+    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+
+
+    iput-object p2, p0, Lcom/android/server/MountService$XmlContainer;->mContext:Landroid/content/Context;
+
+
+    iput-object p3, p0, Lcom/android/server/MountService$XmlContainer;->mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+
+    return-void
+.end method
+
+.method synthetic constructor <init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;Lcom/android/server/MountService$1;)V
+    .locals 0
+    .param p1, "x0"    # Lcom/android/server/MountService;
+    .param p2, "x1"    # Landroid/content/Context;
+    .param p3, "x2"    # Lorg/xmlpull/v1/XmlPullParser;
+    .param p4, "x3"    # Lcom/android/server/MountService$1;
+
+    .prologue
+
+    invoke-direct {p0, p1, p2, p3}, Lcom/android/server/MountService$XmlContainer;-><init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;)V
+
+    return-void
+.end method
+
+
+# virtual methods
+.method public getBoolean(Ljava/lang/String;Z)Z
+    .locals 3
+    .param p1, "name"    # Ljava/lang/String;
+    .param p2, "defValue"    # Z
+
+    .prologue
+
+    iget-object v1, p0, Lcom/android/server/MountService$XmlContainer;->mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+    const/4 v2, 0x0
+
+    invoke-interface {v1, v2, p1}, Lorg/xmlpull/v1/XmlPullParser;->getAttributeValue(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+
+    .local v0, "value":Ljava/lang/String;
+    if-nez v0, :cond_1
+
+
+    .end local p2    # "defValue":Z
+    :cond_0
+    :goto_0
+    return p2
+
+
+    .restart local p2    # "defValue":Z
+    :cond_1
+    const-string v1, "true"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_2
+
+
+    const/4 p2, 0x1
+
+    goto :goto_0
+
+
+    :cond_2
+    const-string v1, "false"
+
+    invoke-virtual {v0, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+
+    const/4 p2, 0x0
+
+    goto :goto_0
+.end method
+
+.method public getInt(Ljava/lang/String;I)I
+    .locals 5
+    .param p1, "name"    # Ljava/lang/String;
+    .param p2, "defValue"    # I
+
+    .prologue
+
+    iget-object v3, p0, Lcom/android/server/MountService$XmlContainer;->mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+    const/4 v4, 0x0
+
+    invoke-interface {v3, v4, p1}, Lorg/xmlpull/v1/XmlPullParser;->getAttributeValue(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v2
+
+
+    .local v2, "value":Ljava/lang/String;
+    if-nez v2, :cond_0
+
+
+    .end local p2    # "defValue":I
+    :goto_0
+    return p2
+
+
+    .restart local p2    # "defValue":I
+    :cond_0
+    move v1, p2
+
+
+    .local v1, "val":I
+    :try_start_0
+    invoke-static {v2}, Ljava/lang/Integer;->parseInt(Ljava/lang/String;)I
+    :try_end_0
+    .catch Ljava/lang/NumberFormatException; {:try_start_0 .. :try_end_0} :catch_0
+
+    move-result v1
+
+    :goto_1
+    move p2, v1
+
+
+    goto :goto_0
+
+
+    :catch_0
+    move-exception v0
+
+
+    .local v0, "e":Ljava/lang/NumberFormatException;
+    move v1, p2
+
+    goto :goto_1
+.end method
+
+.method public getResourceId(Ljava/lang/String;I)I
+    .locals 9
+    .param p1, "name"    # Ljava/lang/String;
+    .param p2, "defValue"    # I
+
+    .prologue
+    const/4 v8, 0x1
+
+
+    const/4 v1, 0x0
+
+
+    .local v1, "id":I
+    iget-object v6, p0, Lcom/android/server/MountService$XmlContainer;->mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+    const/4 v7, 0x0
+
+    invoke-interface {v6, v7, p1}, Lorg/xmlpull/v1/XmlPullParser;->getAttributeValue(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v4
+
+
+    .local v4, "value":Ljava/lang/String;
+    if-nez v4, :cond_1
+
+
+    .end local p2    # "defValue":I
+    :cond_0
+    :goto_0
+    return p2
+
+
+    .restart local p2    # "defValue":I
+    :cond_1
+    const/4 v6, 0x0
+
+    invoke-virtual {v4, v6}, Ljava/lang/String;->charAt(I)C
+
+    move-result v6
+
+    const/16 v7, 0x40
+
+    if-ne v6, v7, :cond_2
+
+
+    const/16 v6, 0x2f
+
+    invoke-virtual {v4, v6}, Ljava/lang/String;->indexOf(I)I
+
+    move-result v0
+
+
+    .local v0, "dpos":I
+    if-le v0, v8, :cond_2
+
+
+    invoke-virtual {v4, v8, v0}, Ljava/lang/String;->substring(II)Ljava/lang/String;
+
+    move-result-object v3
+
+
+    .local v3, "tname":Ljava/lang/String;
+    add-int/lit8 v6, v0, 0x1
+
+    invoke-virtual {v4, v6}, Ljava/lang/String;->substring(I)Ljava/lang/String;
+
+    move-result-object v5
+
+
+    .local v5, "vname":Ljava/lang/String;
+    iget-object v6, p0, Lcom/android/server/MountService$XmlContainer;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v6}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+
+    move-result-object v2
+
+
+    .local v2, "res":Landroid/content/res/Resources;
+    iget-object v6, p0, Lcom/android/server/MountService$XmlContainer;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v6}, Landroid/content/Context;->getPackageName()Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v2, v5, v3, v6}, Landroid/content/res/Resources;->getIdentifier(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)I
+
+    move-result v1
+
+
+    .end local v0    # "dpos":I
+    .end local v2    # "res":Landroid/content/res/Resources;
+    .end local v3    # "tname":Ljava/lang/String;
+    .end local v5    # "vname":Ljava/lang/String;
+    :cond_2
+    if-eqz v1, :cond_0
+
+    move p2, v1
+
+
+    goto :goto_0
+.end method
+
+.method public getString(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+    .locals 3
+    .param p1, "name"    # Ljava/lang/String;
+    .param p2, "defValue"    # Ljava/lang/String;
+
+    .prologue
+
+    iget-object v1, p0, Lcom/android/server/MountService$XmlContainer;->mParser:Lorg/xmlpull/v1/XmlPullParser;
+
+    const/4 v2, 0x0
+
+    invoke-interface {v1, v2, p1}, Lorg/xmlpull/v1/XmlPullParser;->getAttributeValue(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+
+    move-result-object v0
+
+
+    .local v0, "value":Ljava/lang/String;
+    if-nez v0, :cond_0
+
+
+    .end local p2    # "defValue":Ljava/lang/String;
+    :goto_0
+    return-object p2
+
+    .restart local p2    # "defValue":Ljava/lang/String;
+    :cond_0
+    move-object p2, v0
+
+    goto :goto_0
+.end method
+
+.method public getText(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
+    .locals 2
+    .param p1, "name"    # Ljava/lang/String;
+    .param p2, "defValue"    # Ljava/lang/String;
+
+    .prologue
+
+    const/4 v1, 0x0
+
+    invoke-virtual {p0, p1, v1}, Lcom/android/server/MountService$XmlContainer;->getResourceId(Ljava/lang/String;I)I
+
+    move-result v0
+
+
+    .local v0, "id":I
+    if-eqz v0, :cond_0
+
+
+    iget-object v1, p0, Lcom/android/server/MountService$XmlContainer;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+
+    move-result-object v1
+
+    invoke-virtual {v1, v0}, Landroid/content/res/Resources;->getString(I)Ljava/lang/String;
+
+    move-result-object p2
+
+
+    .end local p2    # "defValue":Ljava/lang/String;
+    :cond_0
+    return-object p2
+.end method
diff --git a/services.jar/smali/com/android/server/MountService.smali b/services.jar/smali/com/android/server/MountService.smali
index 9ebdcd5..1eba344 100644
--- a/services.jar/smali/com/android/server/MountService.smali
+++ b/services.jar/smali/com/android/server/MountService.smali
@@ -14,6 +14,8 @@
         Lcom/android/server/MountService$MountObbAction;,
         Lcom/android/server/MountService$ObbAction;,
         Lcom/android/server/MountService$ObbActionHandler;,
+        Lcom/android/server/MountService$StorageItem;,
+        Lcom/android/server/MountService$XmlContainer;,
         Lcom/android/server/MountService$MountServiceBinderListener;,
         Lcom/android/server/MountService$MountServiceHandler;,
         Lcom/android/server/MountService$ShutdownCallBack;,
@@ -38,6 +40,8 @@
 
 .field static final DEFAULT_CONTAINER_COMPONENT:Landroid/content/ComponentName;
 
+.field private static final FILE_STORAGE_LIST:Ljava/lang/String; = "/data/system/storage_list.xml"
+
 .field private static final H_SYSTEM_READY:I = 0x4
 
 .field private static final H_UNMOUNT_MS:I = 0x3
@@ -2800,547 +2804,936 @@
 .end method
 
 .method private readStorageListLocked()V
-    .locals 31
+    .locals 30
 
+    .prologue
+    .line 1343
     move-object/from16 v0, p0
 
-    iget-object v3, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
+    iget-object v4, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
 
-    invoke-virtual {v3}, Ljava/util/ArrayList;->clear()V
+    invoke-virtual {v4}, Ljava/util/ArrayList;->clear()V
 
+    .line 1344
     move-object/from16 v0, p0
 
-    iget-object v3, v0, Lcom/android/server/MountService;->mVolumeStates:Ljava/util/HashMap;
+    iget-object v4, v0, Lcom/android/server/MountService;->mVolumeStates:Ljava/util/HashMap;
 
-    invoke-virtual {v3}, Ljava/util/HashMap;->clear()V
+    invoke-virtual {v4}, Ljava/util/HashMap;->clear()V
 
-    move-object/from16 v0, p0
+    .line 1346
+    const/16 v19, 0x0
 
-    iget-object v3, v0, Lcom/android/server/MountService;->mContext:Landroid/content/Context;
+    .line 1349
+    .local v19, "fis":Ljava/io/FileInputStream;
+    :try_start_0
+    invoke-static {}, Lorg/xmlpull/v1/XmlPullParserFactory;->newInstance()Lorg/xmlpull/v1/XmlPullParserFactory;
 
-    invoke-virtual {v3}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+    move-result-object v17
 
-    move-result-object v24
+    .line 1350
+    .local v17, "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    invoke-virtual/range {v17 .. v17}, Lorg/xmlpull/v1/XmlPullParserFactory;->newPullParser()Lorg/xmlpull/v1/XmlPullParser;
 
-    const v19, 0x10f0010
+    move-result-object v25
 
-    move-object/from16 v0, v24
+    .line 1351
+    .local v25, "parser":Lorg/xmlpull/v1/XmlPullParser;
+    new-instance v18, Ljava/io/File;
 
-    move/from16 v1, v19
+    const-string v4, "/data/system/storage_list.xml"
 
-    invoke-virtual {v0, v1}, Landroid/content/res/Resources;->getXml(I)Landroid/content/res/XmlResourceParser;
+    move-object/from16 v0, v18
 
-    move-result-object v22
+    invoke-direct {v0, v4}, Ljava/io/File;-><init>(Ljava/lang/String;)V
 
-    invoke-static/range {v22 .. v22}, Landroid/util/Xml;->asAttributeSet(Lorg/xmlpull/v1/XmlPullParser;)Landroid/util/AttributeSet;
+    .line 1352
+    .local v18, "file":Ljava/io/File;
+    new-instance v20, Ljava/io/FileInputStream;
 
-    move-result-object v14
+    move-object/from16 v0, v20
 
-    :try_start_0
-    const-string v3, "StorageList"
+    move-object/from16 v1, v18
 
-    move-object/from16 v0, v22
+    invoke-direct {v0, v1}, Ljava/io/FileInputStream;-><init>(Ljava/io/File;)V
+    :try_end_0
+    .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_0 .. :try_end_0} :catch_5
+    .catch Ljava/io/IOException; {:try_start_0 .. :try_end_0} :catch_4
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
-    invoke-static {v0, v3}, Lcom/android/internal/util/XmlUtils;->beginDocument(Lorg/xmlpull/v1/XmlPullParser;Ljava/lang/String;)V
+    .line 1353
+    .end local v19    # "fis":Ljava/io/FileInputStream;
+    .local v20, "fis":Ljava/io/FileInputStream;
+    :try_start_1
+    new-instance v26, Ljava/io/InputStreamReader;
 
-    :cond_0
+    const-string v4, "UTF-8"
+
+    move-object/from16 v0, v26
+
+    move-object/from16 v1, v20
+
+    invoke-direct {v0, v1, v4}, Ljava/io/InputStreamReader;-><init>(Ljava/io/InputStream;Ljava/lang/String;)V
+
+    .line 1354
+    .local v26, "reader":Ljava/io/InputStreamReader;
+    invoke-interface/range {v25 .. v26}, Lorg/xmlpull/v1/XmlPullParser;->setInput(Ljava/io/Reader;)V
+
+    .line 1356
+    const/4 v4, 0x5
+
+    new-array v0, v4, [Ljava/lang/String;
+
+    move-object/from16 v24, v0
+
+    .line 1358
+    .local v24, "nodeList":[Ljava/lang/String;
     :goto_0
-    invoke-static/range {v22 .. v22}, Lcom/android/internal/util/XmlUtils;->nextElement(Lorg/xmlpull/v1/XmlPullParser;)V
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->getEventType()I
 
-    invoke-interface/range {v22 .. v22}, Landroid/content/res/XmlResourceParser;->getName()Ljava/lang/String;
-    :try_end_0
-    .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_0 .. :try_end_0} :catch_0
-    .catch Ljava/io/IOException; {:try_start_0 .. :try_end_0} :catch_1
-    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+    move-result v4
 
-    move-result-object v17
+    const/4 v5, 0x1
 
-    if-nez v17, :cond_2
+    if-eq v4, v5, :cond_b
 
-    invoke-virtual/range {p0 .. p0}, Lcom/android/server/MountService;->isExternalStorageEmulated()Z
+    .line 1359
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->getEventType()I
 
-    move-result v3
+    move-result v16
 
-    if-eqz v3, :cond_b
+    .line 1360
+    .local v16, "eventType":I
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->getDepth()I
 
-    const/16 v20, 0x1
+    move-result v14
 
-    :goto_1
-    move-object/from16 v0, p0
+    .line 1361
+    .local v14, "depth":I
+    const/16 v27, 0x0
 
-    iget-object v3, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
+    .line 1363
+    .local v27, "s":Lcom/android/server/MountService$StorageItem;
+    const/4 v4, 0x2
 
-    invoke-virtual {v3}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;
+    move/from16 v0, v16
 
-    move-result-object v18
+    if-ne v0, v4, :cond_0
 
-    :cond_1
-    :goto_2
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->hasNext()Z
+    .line 1364
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->getName()Ljava/lang/String;
 
-    move-result v3
+    move-result-object v4
 
-    if-eqz v3, :cond_9
+    aput-object v4, v24, v14
 
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+    .line 1365
+    const/4 v4, 0x1
 
-    move-result-object v2
+    aget-object v4, v24, v4
 
-    check-cast v2, Landroid/os/storage/StorageVolume;
+    if-eqz v4, :cond_0
 
-    invoke-virtual {v2}, Landroid/os/storage/StorageVolume;->isEmulated()Z
+    const/4 v4, 0x1
 
-    move-result v3
+    aget-object v4, v24, v4
 
-    if-nez v3, :cond_1
+    const-string v5, "StorageList"
 
-    add-int/lit8 v21, v20, 0x1
+    invoke-virtual {v4, v5}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
-    move/from16 v0, v20
+    move-result v4
 
-    invoke-virtual {v2, v0}, Landroid/os/storage/StorageVolume;->setStorageId(I)V
+    if-eqz v4, :cond_0
 
-    move/from16 v20, v21
+    .line 1366
+    const/4 v4, 0x2
 
-    goto :goto_2
+    aget-object v4, v24, v4
 
-    :cond_2
-    :try_start_1
-    const-string v3, "storage"
+    if-eqz v4, :cond_0
 
-    move-object/from16 v0, v17
+    const/4 v4, 0x2
 
-    invoke-virtual {v3, v0}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+    aget-object v4, v24, v4
 
-    move-result v3
+    const-string v5, "storage"
 
-    if-eqz v3, :cond_0
+    invoke-virtual {v4, v5}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v4
 
-    sget-object v3, Lcom/android/internal/R$styleable;->Storage:[I
+    if-eqz v4, :cond_0
 
-    move-object/from16 v0, v24
+    .line 1367
+    const/4 v4, 0x2
 
-    invoke-virtual {v0, v14, v3}, Landroid/content/res/Resources;->obtainAttributes(Landroid/util/AttributeSet;[I)Landroid/content/res/TypedArray;
+    if-ne v14, v4, :cond_0
 
-    move-result-object v13
+    .line 1368
+    new-instance v27, Lcom/android/server/MountService$StorageItem;
 
-    const/4 v3, 0x0
+    .end local v27    # "s":Lcom/android/server/MountService$StorageItem;
+    move-object/from16 v0, p0
 
-    invoke-virtual {v13, v3}, Landroid/content/res/TypedArray;->getString(I)Ljava/lang/String;
+    iget-object v4, v0, Lcom/android/server/MountService;->mContext:Landroid/content/Context;
 
-    move-result-object v23
+    const/4 v5, 0x0
 
-    const/4 v3, 0x1
+    move-object/from16 v0, v27
 
-    const/4 v12, -0x1
+    move-object/from16 v1, p0
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getResourceId(II)I
+    move-object/from16 v2, v25
 
-    move-result v4
+    invoke-direct {v0, v1, v4, v2, v5}, Lcom/android/server/MountService$StorageItem;-><init>(Lcom/android/server/MountService;Landroid/content/Context;Lorg/xmlpull/v1/XmlPullParser;Lcom/android/server/MountService$1;)V
 
-    const/4 v3, 0x1
+    .line 1369
+    .restart local v27    # "s":Lcom/android/server/MountService$StorageItem;
+    invoke-virtual/range {v27 .. v27}, Lcom/android/server/MountService$StorageItem;->loadNode()Z
 
-    invoke-virtual {v13, v3}, Landroid/content/res/TypedArray;->getText(I)Ljava/lang/CharSequence;
+    move-result v4
 
-    move-result-object v15
+    if-nez v4, :cond_0
 
-    const/4 v3, 0x2
+    .line 1370
+    const-string v4, "MountService"
 
-    const/4 v12, 0x0
+    new-instance v5, Ljava/lang/StringBuilder;
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getBoolean(IZ)Z
+    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V
 
-    move-result v5
+    const-string v6, "can\'t parse XML file (line = "
 
-    const/4 v3, 0x3
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const/4 v12, 0x0
+    move-result-object v5
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getBoolean(IZ)Z
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->getLineNumber()I
 
     move-result v6
 
-    const/4 v3, 0x4
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    const/4 v12, 0x0
+    move-result-object v5
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getBoolean(IZ)Z
+    const-string v6, ")"
 
-    move-result v7
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const/4 v3, 0x5
+    move-result-object v5
 
-    const/4 v12, 0x0
+    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getInt(II)I
+    move-result-object v5
 
-    move-result v8
+    invoke-static {v4, v5}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    const/4 v3, 0x6
+    .line 1371
+    const/16 v27, 0x0
 
-    const/4 v12, 0x0
+    .line 1378
+    :cond_0
+    const/4 v4, 0x3
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getBoolean(IZ)Z
+    move/from16 v0, v16
 
-    move-result v9
+    if-ne v0, v4, :cond_1
 
-    const/4 v3, 0x7
+    .line 1379
+    const/4 v4, 0x0
 
-    const/4 v12, 0x0
+    aput-object v4, v24, v14
 
-    invoke-virtual {v13, v3, v12}, Landroid/content/res/TypedArray;->getInt(II)I
+    .line 1380
+    const/4 v4, 0x1
 
-    move-result v3
+    if-gt v14, v4, :cond_1
 
-    int-to-long v0, v3
+    .line 1381
+    const/16 v27, 0x0
 
-    move-wide/from16 v27, v0
+    .line 1385
+    :cond_1
+    const/4 v4, 0x2
 
-    const-wide/16 v29, 0x400
+    move/from16 v0, v16
 
-    mul-long v27, v27, v29
+    if-ne v0, v4, :cond_6
 
-    const-wide/16 v29, 0x400
+    const/4 v4, 0x2
 
-    mul-long v10, v27, v29
+    if-ne v14, v4, :cond_6
 
-    const-string v3, "MountService"
+    if-eqz v27, :cond_6
+
+    .line 1386
+    const-string v4, "MountService"
 
-    new-instance v12, Ljava/lang/StringBuilder;
+    new-instance v5, Ljava/lang/StringBuilder;
 
-    invoke-direct {v12}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V
 
-    const-string v27, "got storage path: "
+    const-string v6, "got storage path: \'"
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-object v6, v0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-object/from16 v0, v23
+    move-result-object v5
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    const-string v6, "\', description: \'"
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const-string v27, " description: "
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-object v6, v0, Lcom/android/server/MountService$StorageItem;->description:Ljava/lang/String;
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v15}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    const-string v6, "\', primary: "
 
-    const-string v27, " primary: "
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-boolean v6, v0, Lcom/android/server/MountService$StorageItem;->primary:Z
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v5}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    const-string v6, ", removable: "
 
-    const-string v27, " removable: "
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-boolean v6, v0, Lcom/android/server/MountService$StorageItem;->removable:Z
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    const-string v6, ", emulated: "
 
-    const-string v27, " emulated: "
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-boolean v6, v0, Lcom/android/server/MountService$StorageItem;->emulated:Z
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v7}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    const-string v6, ", mtpReserve: "
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const-string v27, " mtpReserve: "
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget v6, v0, Lcom/android/server/MountService$StorageItem;->mtpReserve:I
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    move-result-object v5
 
-    invoke-virtual {v12, v8}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+    const-string v6, ", allowMassStorage: "
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const-string v27, " allowMassStorage: "
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-boolean v6, v0, Lcom/android/server/MountService$StorageItem;->allowMassStorage:Z
 
-    move-result-object v12
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v9}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    const-string v6, ", maxFileSize: "
+
+    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    const-string v27, " maxFileSize: "
+    move-result-object v5
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v12, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    iget-wide v6, v0, Lcom/android/server/MountService$StorageItem;->maxFileSize:J
 
-    move-result-object v12
+    invoke-virtual {v5, v6, v7}, Ljava/lang/StringBuilder;->append(J)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v12, v10, v11}, Ljava/lang/StringBuilder;->append(J)Ljava/lang/StringBuilder;
+    move-result-object v5
 
-    move-result-object v12
+    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v5
 
-    invoke-virtual {v12}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-static {v4, v5}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
 
-    move-result-object v12
+    .line 1392
+    move-object/from16 v0, v27
 
-    invoke-static {v3, v12}, Landroid/util/Slog;->d(Ljava/lang/String;Ljava/lang/String;)I
+    iget-boolean v4, v0, Lcom/android/server/MountService$StorageItem;->emulated:Z
 
-    if-eqz v7, :cond_4
+    if-eqz v4, :cond_4
 
-    new-instance v2, Landroid/os/storage/StorageVolume;
+    move-object/from16 v0, v27
 
-    const/4 v3, 0x0
+    iget-boolean v4, v0, Lcom/android/server/MountService$StorageItem;->primary:Z
 
-    const/4 v5, 0x1
+    if-eqz v4, :cond_4
 
-    const/4 v6, 0x0
+    .line 1395
+    new-instance v3, Landroid/os/storage/StorageVolume;
 
-    const/4 v7, 0x1
+    const/4 v4, 0x0
 
-    const/4 v9, 0x0
+    move-object/from16 v0, v27
 
-    const/4 v12, 0x0
+    iget v5, v0, Lcom/android/server/MountService$StorageItem;->descriptionId:I
 
-    invoke-direct/range {v2 .. v12}, Landroid/os/storage/StorageVolume;-><init>(Ljava/io/File;IZZZIZJLandroid/os/UserHandle;)V
+    const/4 v6, 0x1
+
+    const/4 v7, 0x0
+
+    const/4 v8, 0x1
+
+    move-object/from16 v0, v27
+
+    iget v9, v0, Lcom/android/server/MountService$StorageItem;->mtpReserve:I
+
+    const/4 v10, 0x0
+
+    move-object/from16 v0, v27
+
+    iget-wide v11, v0, Lcom/android/server/MountService$StorageItem;->maxFileSize:J
+
+    const/4 v13, 0x0
+
+    invoke-direct/range {v3 .. v13}, Landroid/os/storage/StorageVolume;-><init>(Ljava/io/File;IZZZIZJLandroid/os/UserHandle;)V
 
     move-object/from16 v0, p0
 
-    iput-object v2, v0, Lcom/android/server/MountService;->mEmulatedTemplate:Landroid/os/storage/StorageVolume;
+    iput-object v3, v0, Lcom/android/server/MountService;->mEmulatedTemplate:Landroid/os/storage/StorageVolume;
 
+    .line 1398
     invoke-static {}, Lcom/android/server/pm/UserManagerService;->getInstance()Lcom/android/server/pm/UserManagerService;
 
-    move-result-object v26
+    move-result-object v29
 
-    const/4 v3, 0x0
+    .line 1399
+    .local v29, "userManager":Lcom/android/server/pm/UserManagerService;
+    const/4 v4, 0x0
 
-    move-object/from16 v0, v26
+    move-object/from16 v0, v29
 
-    invoke-virtual {v0, v3}, Lcom/android/server/pm/UserManagerService;->getUsers(Z)Ljava/util/List;
+    invoke-virtual {v0, v4}, Lcom/android/server/pm/UserManagerService;->getUsers(Z)Ljava/util/List;
 
-    move-result-object v3
+    move-result-object v4
 
-    invoke-interface {v3}, Ljava/util/List;->iterator()Ljava/util/Iterator;
+    invoke-interface {v4}, Ljava/util/List;->iterator()Ljava/util/Iterator;
 
-    move-result-object v18
+    move-result-object v21
 
-    :goto_3
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->hasNext()Z
+    .local v21, "i$":Ljava/util/Iterator;
+    :goto_1
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->hasNext()Z
 
-    move-result v3
+    move-result v4
 
-    if-eqz v3, :cond_6
+    if-eqz v4, :cond_6
 
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->next()Ljava/lang/Object;
 
-    move-result-object v25
+    move-result-object v28
 
-    check-cast v25, Landroid/content/pm/UserInfo;
+    check-cast v28, Landroid/content/pm/UserInfo;
 
-    invoke-virtual/range {v25 .. v25}, Landroid/content/pm/UserInfo;->getUserHandle()Landroid/os/UserHandle;
+    .line 1400
+    .local v28, "user":Landroid/content/pm/UserInfo;
+    invoke-virtual/range {v28 .. v28}, Landroid/content/pm/UserInfo;->getUserHandle()Landroid/os/UserHandle;
 
-    move-result-object v3
+    move-result-object v4
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3}, Lcom/android/server/MountService;->createEmulatedVolumeForUserLocked(Landroid/os/UserHandle;)V
+    invoke-direct {v0, v4}, Lcom/android/server/MountService;->createEmulatedVolumeForUserLocked(Landroid/os/UserHandle;)V
     :try_end_1
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_1 .. :try_end_1} :catch_0
     .catch Ljava/io/IOException; {:try_start_1 .. :try_end_1} :catch_1
-    .catchall {:try_start_1 .. :try_end_1} :catchall_0
+    .catchall {:try_start_1 .. :try_end_1} :catchall_1
 
-    goto :goto_3
+    goto :goto_1
 
+    .line 1421
+    .end local v14    # "depth":I
+    .end local v16    # "eventType":I
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v24    # "nodeList":[Ljava/lang/String;
+    .end local v26    # "reader":Ljava/io/InputStreamReader;
+    .end local v27    # "s":Lcom/android/server/MountService$StorageItem;
+    .end local v28    # "user":Landroid/content/pm/UserInfo;
+    .end local v29    # "userManager":Lcom/android/server/pm/UserManagerService;
     :catch_0
-    move-exception v16
+    move-exception v15
 
-    :try_start_2
-    new-instance v3, Ljava/lang/RuntimeException;
+    move-object/from16 v19, v20
 
-    move-object/from16 v0, v16
+    .line 1422
+    .end local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .end local v18    # "file":Ljava/io/File;
+    .end local v20    # "fis":Ljava/io/FileInputStream;
+    .end local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .local v15, "e":Lorg/xmlpull/v1/XmlPullParserException;
+    .restart local v19    # "fis":Ljava/io/FileInputStream;
+    :goto_2
+    :try_start_2
+    new-instance v4, Ljava/lang/RuntimeException;
 
-    invoke-direct {v3, v0}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
+    invoke-direct {v4, v15}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
 
-    throw v3
+    throw v4
     :try_end_2
     .catchall {:try_start_2 .. :try_end_2} :catchall_0
 
+    .line 1428
+    .end local v15    # "e":Lorg/xmlpull/v1/XmlPullParserException;
     :catchall_0
-    move-exception v3
+    move-exception v4
 
+    :goto_3
     invoke-virtual/range {p0 .. p0}, Lcom/android/server/MountService;->isExternalStorageEmulated()Z
 
-    move-result v12
+    move-result v5
 
-    if-eqz v12, :cond_a
+    if-eqz v5, :cond_a
 
-    const/16 v20, 0x1
+    const/16 v22, 0x1
 
+    .line 1429
+    .local v22, "index":I
     :goto_4
     move-object/from16 v0, p0
 
-    iget-object v12, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
+    iget-object v5, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
 
-    invoke-virtual {v12}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;
+    invoke-virtual {v5}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;
 
-    move-result-object v18
+    move-result-object v21
 
-    :cond_3
+    .restart local v21    # "i$":Ljava/util/Iterator;
+    :cond_2
     :goto_5
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->hasNext()Z
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->hasNext()Z
 
-    move-result v12
+    move-result v5
 
-    if-eqz v12, :cond_8
+    if-eqz v5, :cond_8
 
-    invoke-interface/range {v18 .. v18}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->next()Ljava/lang/Object;
 
-    move-result-object v2
+    move-result-object v3
 
-    check-cast v2, Landroid/os/storage/StorageVolume;
+    check-cast v3, Landroid/os/storage/StorageVolume;
 
-    invoke-virtual {v2}, Landroid/os/storage/StorageVolume;->isEmulated()Z
+    .line 1430
+    .local v3, "volume":Landroid/os/storage/StorageVolume;
+    invoke-virtual {v3}, Landroid/os/storage/StorageVolume;->isEmulated()Z
 
-    move-result v12
+    move-result v5
 
-    if-nez v12, :cond_3
+    if-eqz v5, :cond_3
 
-    add-int/lit8 v21, v20, 0x1
+    invoke-virtual {v3}, Landroid/os/storage/StorageVolume;->isPrimary()Z
 
-    move/from16 v0, v20
+    move-result v5
 
-    invoke-virtual {v2, v0}, Landroid/os/storage/StorageVolume;->setStorageId(I)V
+    if-nez v5, :cond_2
 
-    move/from16 v20, v21
+    .line 1431
+    :cond_3
+    add-int/lit8 v23, v22, 0x1
 
+    .end local v22    # "index":I
+    .local v23, "index":I
+    move/from16 v0, v22
+
+    invoke-virtual {v3, v0}, Landroid/os/storage/StorageVolume;->setStorageId(I)V
+
+    move/from16 v22, v23
+
+    .end local v23    # "index":I
+    .restart local v22    # "index":I
     goto :goto_5
 
+    .line 1404
+    .end local v3    # "volume":Landroid/os/storage/StorageVolume;
+    .end local v19    # "fis":Ljava/io/FileInputStream;
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v22    # "index":I
+    .restart local v14    # "depth":I
+    .restart local v16    # "eventType":I
+    .restart local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .restart local v18    # "file":Ljava/io/File;
+    .restart local v20    # "fis":Ljava/io/FileInputStream;
+    .restart local v24    # "nodeList":[Ljava/lang/String;
+    .restart local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .restart local v26    # "reader":Ljava/io/InputStreamReader;
+    .restart local v27    # "s":Lcom/android/server/MountService$StorageItem;
     :cond_4
-    if-eqz v23, :cond_5
+    :try_start_3
+    move-object/from16 v0, v27
+
+    iget-object v4, v0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
+
+    if-eqz v4, :cond_5
+
+    move-object/from16 v0, v27
 
-    if-nez v15, :cond_7
+    iget-object v4, v0, Lcom/android/server/MountService$StorageItem;->description:Ljava/lang/String;
 
+    if-nez v4, :cond_7
+
+    .line 1405
     :cond_5
-    :try_start_3
-    const-string v3, "MountService"
+    const-string v4, "MountService"
 
-    const-string v12, "Missing storage path or description in readStorageList"
+    const-string v5, "Missing storage path or description in readStorageList"
 
-    invoke-static {v3, v12}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v4, v5}, Landroid/util/Slog;->e(Ljava/lang/String;Ljava/lang/String;)I
 
+    .line 1419
     :cond_6
     :goto_6
-    invoke-virtual {v13}, Landroid/content/res/TypedArray;->recycle()V
+    invoke-interface/range {v25 .. v25}, Lorg/xmlpull/v1/XmlPullParser;->next()I
     :try_end_3
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_3 .. :try_end_3} :catch_0
     .catch Ljava/io/IOException; {:try_start_3 .. :try_end_3} :catch_1
-    .catchall {:try_start_3 .. :try_end_3} :catchall_0
+    .catchall {:try_start_3 .. :try_end_3} :catchall_1
 
     goto/16 :goto_0
 
+    .line 1423
+    .end local v14    # "depth":I
+    .end local v16    # "eventType":I
+    .end local v24    # "nodeList":[Ljava/lang/String;
+    .end local v26    # "reader":Ljava/io/InputStreamReader;
+    .end local v27    # "s":Lcom/android/server/MountService$StorageItem;
     :catch_1
-    move-exception v16
-
+    move-exception v15
+
+    move-object/from16 v19, v20
+
+    .line 1424
+    .end local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .end local v18    # "file":Ljava/io/File;
+    .end local v20    # "fis":Ljava/io/FileInputStream;
+    .end local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .local v15, "e":Ljava/io/IOException;
+    .restart local v19    # "fis":Ljava/io/FileInputStream;
+    :goto_7
     :try_start_4
-    new-instance v3, Ljava/lang/RuntimeException;
-
-    move-object/from16 v0, v16
+    new-instance v4, Ljava/lang/RuntimeException;
 
-    invoke-direct {v3, v0}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
+    invoke-direct {v4, v15}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
 
-    throw v3
+    throw v4
     :try_end_4
     .catchall {:try_start_4 .. :try_end_4} :catchall_0
 
+    .line 1407
+    .end local v15    # "e":Ljava/io/IOException;
+    .end local v19    # "fis":Ljava/io/FileInputStream;
+    .restart local v14    # "depth":I
+    .restart local v16    # "eventType":I
+    .restart local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .restart local v18    # "file":Ljava/io/File;
+    .restart local v20    # "fis":Ljava/io/FileInputStream;
+    .restart local v24    # "nodeList":[Ljava/lang/String;
+    .restart local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .restart local v26    # "reader":Ljava/io/InputStreamReader;
+    .restart local v27    # "s":Lcom/android/server/MountService$StorageItem;
     :cond_7
     :try_start_5
-    new-instance v2, Landroid/os/storage/StorageVolume;
+    new-instance v3, Landroid/os/storage/StorageVolume;
 
-    new-instance v3, Ljava/io/File;
+    new-instance v4, Ljava/io/File;
 
-    move-object/from16 v0, v23
+    move-object/from16 v0, v27
 
-    invoke-direct {v3, v0}, Ljava/io/File;-><init>(Ljava/lang/String;)V
+    iget-object v5, v0, Lcom/android/server/MountService$StorageItem;->path:Ljava/lang/String;
 
-    const/4 v12, 0x0
+    invoke-direct {v4, v5}, Ljava/io/File;-><init>(Ljava/lang/String;)V
 
-    invoke-direct/range {v2 .. v12}, Landroid/os/storage/StorageVolume;-><init>(Ljava/io/File;IZZZIZJLandroid/os/UserHandle;)V
+    move-object/from16 v0, v27
 
-    move-object/from16 v0, p0
+    iget v5, v0, Lcom/android/server/MountService$StorageItem;->descriptionId:I
 
-    invoke-direct {v0, v2}, Lcom/android/server/MountService;->addVolumeLocked(Landroid/os/storage/StorageVolume;)V
+    move-object/from16 v0, v27
 
-    move-object/from16 v0, p0
+    iget-boolean v6, v0, Lcom/android/server/MountService$StorageItem;->primary:Z
 
-    iget-object v3, v0, Lcom/android/server/MountService;->mVolumeStates:Ljava/util/HashMap;
+    move-object/from16 v0, v27
 
-    invoke-virtual {v2}, Landroid/os/storage/StorageVolume;->getPath()Ljava/lang/String;
+    iget-boolean v7, v0, Lcom/android/server/MountService$StorageItem;->removable:Z
 
-    move-result-object v12
+    move-object/from16 v0, v27
 
-    const-string v27, "unmounted"
+    iget-boolean v8, v0, Lcom/android/server/MountService$StorageItem;->emulated:Z
 
     move-object/from16 v0, v27
 
-    invoke-virtual {v3, v12, v0}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
+    iget v9, v0, Lcom/android/server/MountService$StorageItem;->mtpReserve:I
 
-    const-string v3, "unmounted"
+    move-object/from16 v0, v27
 
-    invoke-virtual {v2, v3}, Landroid/os/storage/StorageVolume;->setState(Ljava/lang/String;)V
+    iget-boolean v10, v0, Lcom/android/server/MountService$StorageItem;->allowMassStorage:Z
+
+    move-object/from16 v0, v27
+
+    iget-wide v11, v0, Lcom/android/server/MountService$StorageItem;->maxFileSize:J
+
+    const/4 v13, 0x0
+
+    invoke-direct/range {v3 .. v13}, Landroid/os/storage/StorageVolume;-><init>(Ljava/io/File;IZZZIZJLandroid/os/UserHandle;)V
+
+    .line 1410
+    .restart local v3    # "volume":Landroid/os/storage/StorageVolume;
+    move-object/from16 v0, p0
+
+    invoke-direct {v0, v3}, Lcom/android/server/MountService;->addVolumeLocked(Landroid/os/storage/StorageVolume;)V
+
+    .line 1413
+    move-object/from16 v0, p0
+
+    iget-object v4, v0, Lcom/android/server/MountService;->mVolumeStates:Ljava/util/HashMap;
+
+    invoke-virtual {v3}, Landroid/os/storage/StorageVolume;->getPath()Ljava/lang/String;
+
+    move-result-object v5
+
+    const-string v6, "unmounted"
+
+    invoke-virtual {v4, v5, v6}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
+
+    .line 1414
+    const-string v4, "unmounted"
+
+    invoke-virtual {v3, v4}, Landroid/os/storage/StorageVolume;->setState(Ljava/lang/String;)V
     :try_end_5
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_5 .. :try_end_5} :catch_0
     .catch Ljava/io/IOException; {:try_start_5 .. :try_end_5} :catch_1
-    .catchall {:try_start_5 .. :try_end_5} :catchall_0
+    .catchall {:try_start_5 .. :try_end_5} :catchall_1
 
     goto :goto_6
 
+    .line 1428
+    .end local v3    # "volume":Landroid/os/storage/StorageVolume;
+    .end local v14    # "depth":I
+    .end local v16    # "eventType":I
+    .end local v24    # "nodeList":[Ljava/lang/String;
+    .end local v26    # "reader":Ljava/io/InputStreamReader;
+    .end local v27    # "s":Lcom/android/server/MountService$StorageItem;
+    :catchall_1
+    move-exception v4
+
+    move-object/from16 v19, v20
+
+    .end local v20    # "fis":Ljava/io/FileInputStream;
+    .restart local v19    # "fis":Ljava/io/FileInputStream;
+    goto/16 :goto_3
+
+    .line 1435
+    .end local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .end local v18    # "file":Ljava/io/File;
+    .end local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .restart local v21    # "i$":Ljava/util/Iterator;
+    .restart local v22    # "index":I
     :cond_8
-    invoke-interface/range {v22 .. v22}, Landroid/content/res/XmlResourceParser;->close()V
+    :try_start_6
+    invoke-virtual/range {v19 .. v19}, Ljava/io/FileInputStream;->close()V
+    :try_end_6
+    .catch Ljava/lang/Exception; {:try_start_6 .. :try_end_6} :catch_2
 
-    throw v3
+    .line 1428
+    :goto_8
+    throw v4
 
+    .line 1435
+    .end local v19    # "fis":Ljava/io/FileInputStream;
+    .restart local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .restart local v18    # "file":Ljava/io/File;
+    .restart local v20    # "fis":Ljava/io/FileInputStream;
+    .restart local v24    # "nodeList":[Ljava/lang/String;
+    .restart local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .restart local v26    # "reader":Ljava/io/InputStreamReader;
     :cond_9
-    invoke-interface/range {v22 .. v22}, Landroid/content/res/XmlResourceParser;->close()V
+    :try_start_7
+    invoke-virtual/range {v20 .. v20}, Ljava/io/FileInputStream;->close()V
+    :try_end_7
+    .catch Ljava/lang/Exception; {:try_start_7 .. :try_end_7} :catch_3
 
+    .line 1440
+    :goto_9
     return-void
 
+    .line 1428
+    .end local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .end local v18    # "file":Ljava/io/File;
+    .end local v20    # "fis":Ljava/io/FileInputStream;
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v22    # "index":I
+    .end local v24    # "nodeList":[Ljava/lang/String;
+    .end local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .end local v26    # "reader":Ljava/io/InputStreamReader;
+    .restart local v19    # "fis":Ljava/io/FileInputStream;
     :cond_a
-    const/16 v20, 0x0
+    const/16 v22, 0x0
 
-    goto :goto_4
+    goto/16 :goto_4
 
+    .line 1436
+    .restart local v21    # "i$":Ljava/util/Iterator;
+    .restart local v22    # "index":I
+    :catch_2
+    move-exception v5
+
+    goto :goto_8
+
+    .line 1428
+    .end local v19    # "fis":Ljava/io/FileInputStream;
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v22    # "index":I
+    .restart local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .restart local v18    # "file":Ljava/io/File;
+    .restart local v20    # "fis":Ljava/io/FileInputStream;
+    .restart local v24    # "nodeList":[Ljava/lang/String;
+    .restart local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .restart local v26    # "reader":Ljava/io/InputStreamReader;
     :cond_b
-    const/16 v20, 0x0
+    invoke-virtual/range {p0 .. p0}, Lcom/android/server/MountService;->isExternalStorageEmulated()Z
 
-    goto/16 :goto_1
+    move-result v4
+
+    if-eqz v4, :cond_e
+
+    const/16 v22, 0x1
+
+    .line 1429
+    .restart local v22    # "index":I
+    :goto_a
+    move-object/from16 v0, p0
+
+    iget-object v4, v0, Lcom/android/server/MountService;->mVolumes:Ljava/util/ArrayList;
+
+    invoke-virtual {v4}, Ljava/util/ArrayList;->iterator()Ljava/util/Iterator;
+
+    move-result-object v21
+
+    .restart local v21    # "i$":Ljava/util/Iterator;
+    :cond_c
+    :goto_b
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->hasNext()Z
+
+    move-result v4
+
+    if-eqz v4, :cond_9
+
+    invoke-interface/range {v21 .. v21}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+
+    move-result-object v3
+
+    check-cast v3, Landroid/os/storage/StorageVolume;
+
+    .line 1430
+    .restart local v3    # "volume":Landroid/os/storage/StorageVolume;
+    invoke-virtual {v3}, Landroid/os/storage/StorageVolume;->isEmulated()Z
+
+    move-result v4
+
+    if-eqz v4, :cond_d
+
+    invoke-virtual {v3}, Landroid/os/storage/StorageVolume;->isPrimary()Z
+
+    move-result v4
+
+    if-nez v4, :cond_c
+
+    .line 1431
+    :cond_d
+    add-int/lit8 v23, v22, 0x1
+
+    .end local v22    # "index":I
+    .restart local v23    # "index":I
+    move/from16 v0, v22
+
+    invoke-virtual {v3, v0}, Landroid/os/storage/StorageVolume;->setStorageId(I)V
+
+    move/from16 v22, v23
+
+    .end local v23    # "index":I
+    .restart local v22    # "index":I
+    goto :goto_b
+
+    .line 1428
+    .end local v3    # "volume":Landroid/os/storage/StorageVolume;
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v22    # "index":I
+    :cond_e
+    const/16 v22, 0x0
+
+    goto :goto_a
+
+    .line 1436
+    .restart local v21    # "i$":Ljava/util/Iterator;
+    .restart local v22    # "index":I
+    :catch_3
+    move-exception v4
+
+    goto :goto_9
+
+    .line 1423
+    .end local v17    # "factory":Lorg/xmlpull/v1/XmlPullParserFactory;
+    .end local v18    # "file":Ljava/io/File;
+    .end local v20    # "fis":Ljava/io/FileInputStream;
+    .end local v21    # "i$":Ljava/util/Iterator;
+    .end local v22    # "index":I
+    .end local v24    # "nodeList":[Ljava/lang/String;
+    .end local v25    # "parser":Lorg/xmlpull/v1/XmlPullParser;
+    .end local v26    # "reader":Ljava/io/InputStreamReader;
+    .restart local v19    # "fis":Ljava/io/FileInputStream;
+    :catch_4
+    move-exception v15
+
+    goto/16 :goto_7
+
+    .line 1421
+    :catch_5
+    move-exception v15
+
+    goto/16 :goto_2
 .end method
 
 .method private removeObbStateLocked(Lcom/android/server/MountService$ObbState;)V
-- 
2.7.4

